(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();const N=["A_INICIAL","C_noCartellCadira","D_noCadira_cLlum","E_noCadira_cNormal","F_Tot_cadiratransparent","G_TOT","H_TOT_N1","I_TOT_N3_Esperit","J_cama","K_TOT_2cames","L_TOT_MigCos","M_TOT_MigCara","N_FINAL"];function he(e){const n={};for(let s of N)n[s]=e.loadImage(`img/${s}.png`);return n.endWinImg=e.loadImage("img/END_WIN.png"),n.endLoseImg=e.loadImage("img/END_LOSE.png"),n.font=e.loadFont("fonts/SpecialElite-Regular.ttf"),n.tvStaticSound=e.loadSound("audio/tv_static.wav"),n.backgroundMusic=e.loadSound("audio/bso.mp3"),n}const w={INIT:"init",PLAYING:"playing",RESULTATFINAL:"resultatfinal",SCORES:"scores"},V={TEMPS_CANVI_IMATGES:1e3,NUM_IMATGES_FASE1:6,SEGONS_CANVI_G2IMATGES:10,SEGONS_ULTIMA_FASE:5,BLOCK_INTERACTIONS_TIME:25,QUIZ_BLOCK_TIME:30},me=[{xF:.431,yF:.012,wF:.0528,hF:.095},{xF:.444,yF:.185,wF:.033,hF:.046},{xF:.448,yF:.276,wF:.0238,hF:.03},{xF:.45,yF:.325,wF:.019,hF:.0248},{xF:.453,yF:.36,wF:.012,hF:.0135},{xF:.455,yF:.382,wF:.009,hF:.01},{xF:.455,yF:.4,wF:.009,hF:.005},{xF:.456,yF:.41,wF:.007,hF:.005}];function ge(e,n){const s={correctCount:e,time:parseFloat(n.toFixed(2))};let t=le();t.push(s),t.sort((i,o)=>o.correctCount!==i.correctCount?o.correctCount-i.correctCount:i.time-o.time),t=t.slice(0,5),localStorage.setItem("quizScores",JSON.stringify(t))}function le(){const e=localStorage.getItem("quizScores");return e?JSON.parse(e):[]}function Se(){localStorage.removeItem("quizScores")}let B=0,W=0,Q=!1,ce=!1;function ve(e,n){B=n,W=e.millis(),Q=!0}function we(e,n,s){if(!Q)return;const i=e.millis()-W;let o=ce?30:n||s?500:1e3;if(i>=o){const l=Math.floor(i/o);B=Math.max(0,B-l),W+=l*o,B===0&&(Q=!1)}}function k(){return{minutes:Math.floor(B/60),seconds:B%60,running:Q,finished:B===0}}function Ie(){Q=!1}function ue(){B=0,W=0,Q=!1}function ie(e,n,s,t,i,o=-200,l=-140){const c=e.nf(n,2)+":"+e.nf(s,2),u=t,a=u?e.color(135,35,54):i?e.color(255):e.color(253,241,199),r=u?e.random(-8,8):0,g=e.width/9.5,S=u?g+e.sin(e.frameCount*1.5)*20:g;console.log(u),e.push(),e.translate(e.width*.5+r+o,e.height*.85+r+l),e.textSize(S),e.fill(a),e.text(c,0,0),e.pop()}function J(e){ce=e}const h={correctCount:0,totalQuestions:0,currentIndex:0,selectedAnswer:null};async function Te(e,n,s,t){const l=(await(await fetch("questions.json")).json()).groups;let c=[];h.currentIndex=0,h.correctCount=0;let u=null,a=[];const r=e.createDiv().class("quizDiv").parent(n);let g,S,I,z,A,m,C;function _(){r.html(""),e.createElement("h1","QUESTIONARI").parent(r),g=e.createDiv().class("progress-indicator").parent(r),S=e.createElement("h2","").parent(r),I=e.createDiv().class("answers").parent(r),m=e.createButton("Enviar").class("submit-btn").parent(r).mousePressed(v),C=e.createButton("Tancar").class("closeQuizBtn").parent(r).mousePressed(()=>{r.hide(),te()}),z=e.createDiv("00:00").class("quizTimer").parent(r),A=e.createDiv().class("progress-bullets").parent(r)}function b(){const f=Math.floor(Math.random()*l.length);c=[...l[f]],h.totalQuestions=c.length,_(),P()}function P(){h.currentIndex=0,h.correctCount=0,u=null,a=[],x(h.currentIndex)}function x(f){const d=c[f];S.html(d.question),I.html(""),u=null,a=[];const E=[...d.incorrect_answers,d.correct_answer];R(E);for(let O of E){const H=e.createButton(O).class("quiz-answer-btn").parent(I).mousePressed(()=>{u=O,a.forEach(j=>j.removeClass("selected")),H.addClass("selected")});a.push(H)}F(f+1,c.length)}function v(){if(!u){const d=e.select(".warning");d&&d.remove();const E=e.createP("Selecciona una opció!").addClass("warning").parent(r);setTimeout(()=>E.remove(),500);return}const f=c[h.currentIndex];u===f.correct_answer&&h.correctCount++,h.currentIndex++,h.currentIndex<c.length?x(h.currentIndex):L()}function F(f,d){g.html(`Pregunta ${f} de ${d}`),q(f,d)}function q(f,d){let E="";for(let O=0;O<d;O++)E+=O<f?"● ":"○ ";A.html(E)}function L(){const d=h.correctCount/c.length*100>=90,E=e.millis(),O=t(),H=(E-O)/1e3;if(r.hide(),te(),d)ge(h.correctCount,H),s({current:"resultatfinal"});else{Ae();const{minutes:j,seconds:fe}=k();j*60+fe>90?J(!0):J(!1),s({current:"playing"})}}function R(f){for(let d=f.length-1;d>0;d--){const E=Math.floor(Math.random()*(d+1));[f[d],f[E]]=[f[E],f[d]]}}return b(),r.hide(),{quizDiv:r,questionTitle:S,buttons:a,quizTimer:z,closeBtn:C,submitBtn:m,resetQuiz:P,startNewQuiz:b,resetQuizState:Ce}}function Ce(e,n){if(!e||e.length===0){console.error("Els botons no estan definits.");return}h.currentIndex=0,h.correctCount=0,selectedAnswer=null,e.forEach(s=>{s.removeClass("selected"),s.removeClass("disabled"),s.removeAttribute("disabled")}),n(h.currentIndex)}let M=0,$=0,D=!1,T=!1,y=!1,X=!1,ee=!1,U=0;const{TEMPS_CANVI_IMATGES:Ee,NUM_IMATGES_FASE1:Y,SEGONS_CANVI_G2IMATGES:Z,SEGONS_ULTIMA_FASE:oe,BLOCK_INTERACTIONS_TIME:se}=V;let de=!1,G=!1,p=!1,re=0;function K(e){de=e}let ne=!1;function Ae(){ne=!0}function be(){ne=!1}function Ne(){return ne}function ye(e,n,s,t,i){var c,u,a,r,g,S;if(n.backgroundMusic.isPlaying()&&s.current!==w.PLAYING&&n.backgroundMusic.stop(),s.current===w.PLAYING&&!k().running){const I=t.minuteSlider.value()*60+t.secondSlider.value();ve(e,I),p=!0,re=e.millis(),M=0,$=e.millis(),D=!1,T=!1,y=!1}e.imageMode(e.CORNER),e.textAlign(e.CENTER,e.CENTER);const{minutes:o,seconds:l}=k();switch(o===0&&l<=se&&l>0?(T=!0,t.resetBtn.hide(),K(!1),typeof J=="function"&&J(!1),e.millis()-U<5e3&&t.resetQuiz(),e.millis()-U>5e3&&t.quizDiv.elt.style.display==="none"&&(t.quizDiv.hide(),U=0)):o===0&&l<=se&&U===0?U=e.millis():T=!1,s.current){case w.INIT:e.background(0),ue(),M=0,$=0,D=!1,T=!1,y=!1,e.image(n[N[0]],0,0,e.width,e.height),t.quizDiv.elt.style.display==="none"&&ie(e,t.minuteSlider.value(),t.secondSlider.value(),!1,!1),t.infoBtn.show(),t.pistaBtn.hide(),t.pistaPopup.hide(),p=!1,G=!1;break;case w.PLAYING:const I=y?e.random(-8,8):0;e.push(),e.translate(I,I),_e(e,n),e.pop(),s.scoresShown=!1,t.infoBtn.hide();const z=D&&!T,A=z&&e.mouseX>e.width*.46&&e.mouseX<e.width*.4838&&e.mouseY>e.height*.426&&e.mouseY<e.height*.4416;A&&!G&&(G=!0),p&&!G&&e.millis()-re>=15e3&&(G=!0),D&&G&&!T&&t.quizDiv.elt.style.display==="none"?t.pistaBtn.show():(t.pistaBtn.hide(),t.pistaPopup.hide(),K(!1)),X=z&&e.mouseX>e.width*.65&&e.mouseX<e.width*.77&&e.mouseY>e.height*.77&&e.mouseY<e.height*.93;const C=X||y;we(e,X,y);const{minutes:_,seconds:b,finished:P}=k();_*60+b>V.SEGONS_CANVI_G2IMATGES?n.backgroundMusic.isLoaded()&&!n.backgroundMusic.isPlaying()&&n.backgroundMusic.loop():n.backgroundMusic.isPlaying()&&n.backgroundMusic.stop(),_===0&&b===V.SEGONS_CANVI_G2IMATGES&&D&&!ee&&(ee=!0,y=!0,e.millis(),n.tvStaticSound.isLoaded()&&!n.tvStaticSound.isPlaying()&&n.tvStaticSound.loop()),s.current===w.PLAYING&&_===0&&b<=V.QUIZ_BLOCK_TIME?(t.quizDiv&&t.quizDiv.elt.style.display!=="none"&&t.quizDiv.hide(),(c=t.buttons)==null||c.forEach(d=>{d.attribute("disabled",""),d.addClass("disabled")}),(u=t.submitBtn)!=null&&u.attribute("disabled","")&&((a=t.submitBtn)==null||a.addClass("disabled"))):((r=t.buttons)==null||r.forEach(d=>{d.removeAttribute("disabled"),d.removeClass("disabled")}),(g=t.submitBtn)!=null&&g.removeAttribute("disabled")&&((S=t.submitBtn)==null||S.removeClass("disabled"))),P&&(Ie(),n.tvStaticSound.isPlaying()&&n.tvStaticSound.stop(),s.current=w.RESULTATFINAL);const v=e.select(".quizTimer");v&&v.html(e.nf(_,2)+":"+e.nf(b,2)),t.quizDiv.elt.style.display==="none"&&ie(e,_,b,C,A);break;case w.RESULTATFINAL:e.push(),e.clear(),e.pop(),t.infoBtn.hide(),t.pistaBtn.hide(),t.pistaPopup.hide(),t.resetBtn.hide(),t.quizDiv.hide(),t.resultsDiv.hide();const F=h.correctCount,q=h.totalQuestions,L=Math.round(F/q*100),R=L>=90,f=R?n.endWinImg:n.endLoseImg;t.resultsDiv.removeClass("score-list").addClass("result-final").style("background-image",`url(${f.canvas.toDataURL()})`),R?t.resultsDiv.html(`
          <h1> Has pogut sobreviure? Ara tens ajuda amb la ràdio.</h1>
          <p>Enhorabona! El teu resultat:  ${F} de ${q}</p>
          <p>(${L}% encerts)</p>
        `):t.resultsDiv.html(`
          <h1>ACABES D'ENTRAR EN UN ALTRE MÓN..</h1>
          <p>No has superat el repte plantejat!</p>
        `),t.resultsDiv.show(),setTimeout(()=>{t.resultsDiv.hide(),s.current=w.SCORES},4e3);break;case w.SCORES:t.resultsDiv.removeClass("result-final").addClass("score-list").show(),t.displayScores();break}}function De(e,n,s,t,i){e.push(),e.noStroke(),e.fill(255);for(let l=0;l<t*i*.05;l++){const c=e.random(n,n+t),u=e.random(s,s+i),a=e.random(1,2.5);e.circle(c,u,a)}e.pop()}function _e(e,n){if(de){if(e.image(n.D_noCadira_cLlum,0,0,e.width,e.height),M>=2){const o=e.map(e.sin(e.frameCount*.3+e.random(-.02,.02)),-1,1,20,0);e.push(),e.noStroke(),e.fill(0,o),e.rect(0,0,e.width,e.height),e.pop()}return}const{seconds:s,minutes:t,finished:i}=k();if(!k().running){e.image(n[N[0]],0,0,e.width,e.height);return}if(t===0&&s<Z&&s>=oe){const o=Z-s,l=N.length-Y,c=Math.floor(o/((Z-oe)/l)),u=Math.min(Y+c,N.length-1);e.image(n[N[u]],0,0,e.width,e.height),u===N.length-1&&(D=!0)}else M<Y?(e.image(n[N[M]],0,0,e.width,e.height),e.millis()-$>Ee&&M<Y-1&&(M++,$=e.millis(),M===Y-1&&(D=!0))):i&&e.image(n[N[N.length-1]],0,0,e.width,e.height);if(y&&D){me.forEach(({xF:a,yF:r,wF:g,hF:S})=>{const I=e.width*a,z=e.height*r,A=e.width*g,m=e.height*S;Fe(e,I,z,A,m)});const o=e.width*.744,l=e.height*.141,c=e.width*.096,u=e.height*.131;e.push(),e.translate(o+c/2,l+u/2),e.rotate(e.radians(-9)),De(e,-c/2,-u/2,c,u),e.pop()}}function ze(e,n,s,t,i){const o=e.width*.733,l=e.height*.093,c=e.width*.145,u=e.height*.254;if(D&&!T&&i.button===0&&e.mouseX>o&&e.mouseX<o+c&&e.mouseY>l&&e.mouseY<l+u&&(y||(y=!0,T=!0,n.tvStaticSound.isLoaded()&&n.tvStaticSound.play(),setTimeout(()=>{y=!1,T=!1,n.tvStaticSound.isPlaying()&&n.tvStaticSound.stop()},5e3))),s.current===w.PLAYING&&D&&i.button===2&&!T&&!Ne()){const a=e.width*.08,r=e.height*.11,g=e.width*.138,S=e.height*.25;e.mouseX>a&&e.mouseX<a+g&&e.mouseY>r&&e.mouseY<r+S&&(T=!0,t.quizDiv.style("display","block"),i.preventDefault())}}function te(){T=!1}function Fe(e,n,s,t,i){const o=e.map(e.sin(e.frameCount*.3+e.random(-.02,.02)),-1,1,40,110);e.fill(255,255,200,o*.01),e.drawingContext.shadowBlur=20,e.drawingContext.shadowColor=e.color(255,255,200,40),e.rect(n-6,s-6,t+12,i+12,14),e.fill(255,255,220,o*.07),e.drawingContext.shadowBlur=10,e.drawingContext.shadowColor=e.color(255,255,180,60),e.rect(n-2,s-2,t+4,i+4,10),e.fill(255,250,230,o*.1),e.drawingContext.shadowBlur=5,e.drawingContext.shadowColor=e.color(255,255,240,80),e.rect(n,s,t,i,8),e.drawingContext.shadowBlur=0}function ae(e){h.correctCount=0,h.currentIndex=0,h.totalQuestions=0,h.selectedAnswer=null,e.quizDiv.html("").hide(),ue(),T=!1,y=!1,X=!1,D=!1,$=0,M=0,ee=!1,typeof e.startNewQuiz=="function"&&e.startNewQuiz()}async function Le(e,n,s){let t=0;const i=e.createDiv().id("configDiv").class("configDiv").parent(document.body),o=e.createDiv().class("slider-row").parent(i);let l,c;function u(v,F,q,L,R){const f=e.createDiv().class("slider-block").parent(o);e.createElement("label",v).parent(f);const d=e.createSlider(F,q,L).parent(f);R(d)}u("Minuts:",2,60,2,v=>{l=v}),u("Segons:",0,59,0,v=>{c=v});const a=e.createButton("Jugar").id("playBtn").parent(i).attribute("disabled","").style("opacity","0.5").mousePressed(()=>{t=e.millis(),n({current:w.PLAYING}),a.hide(),r.show(),o.hide(),i.addClass("compact")}),r=e.createButton("Reset").id("resetBtn").parent(i);r.hide();function g(){l.value()*60+c.value()<V.SEGONS_CANVI_G2IMATGES?(a.attribute("disabled",""),a.style("opacity","0.5")):(a.removeAttribute("disabled"),a.style("opacity","1"))}const S=e.createDiv("+ INFO").class("info-btn").parent(i).mouseOver(()=>I.show()).mouseOut(()=>I.hide()),I=e.createDiv().id("infoPopup").addClass("info-popup").parent(i).html("ENTRA AL MÓN DE L'HORROR:<hr><ol><li>Agafa el ratolí</li><li>Configura el teu temps (mínim: 2 minuts)</li><li>Clic a Jugar</li></ol>").hide(),z=e.createDiv("PISTA").class("pista-btn").parent(document.body).mouseOver(()=>{A.show(),K(!0)}).mouseOut(()=>{A.hide(),K(!1)}).hide(),A=e.createDiv().class("pista-popup").parent(document.body).html(`
          <hr>
          <h2>Què puc fer? Estic dels nervis, vull sortir d'aquí!</h2>
          <p>Veig informació en relació a la "direcció" que he de seguir... Dret o esquerre ?</p>
          <hr>
      `).hide(),m=await Te(e,document.body,n,_),C=e.createDiv().class("resultsDiv").id("resultsDiv").parent(document.body).hide();r.mousePressed(()=>{ae({quizDiv:m.quizDiv,buttons:m.buttons}),t=0,n({current:w.INIT}),l.value(2),c.value(0),g(),r.hide(),a.show(),o.style("display","flex"),i.removeClass("compact"),m.quizDiv.hide(),m.startNewQuiz(),te(),be()}),l.input(g),c.input(g),g();function _(){return t}function b(){t=0}function P(){i.removeClass("compact"),o.style("display","flex"),a.show(),r.hide(),l.value(0),c.value(48),g()}function x(){C.style("background-image",`url(${s[N[0]].canvas.toDataURL()})`).html("").show(),e.createElement("h1","🏆 Millors supervivents").parent(C);const v=le();if(v.length){const q=e.createElement("ol").parent(C);v.forEach(L=>e.createElement("li",`${L.correctCount} encerts – ${L.time}s`).parent(q))}else e.createElement("p","SENSE RESULTATS GUARDATS").parent(C);const F=e.createDiv().class("score-buttons").parent(C);e.createButton("ESBORRAR RESULTATS").parent(F).mousePressed(()=>{Se(),x()}),e.createButton("NOU JOC").parent(F).mousePressed(()=>{C.hide(),ae({quizDiv:m.quizDiv,buttons:m.buttons}),b(),P(),n({current:w.INIT})})}return{minuteSlider:l,secondSlider:c,quizDiv:m.quizDiv,questionTitle:m.questionTitle,buttons:m.buttons,quizTimer:m.quizTimer,infoBtn:S,pistaBtn:z,pistaPopup:A,resetBtn:r,closeBtn:m.closeBtn,showInitUI:P,startNewQuiz:m.startNewQuiz,resetQuiz:m.resetQuiz,getStartTime:_,resetStartTime:b,resultsDiv:C,displayScores:x}}new p5(e=>{let n,s,t={current:w.INIT},i,o=!1;const l=a=>t=a;e.preload=()=>{n=he(e)},e.setup=async()=>{c(),e.textFont(n.font),s=await Le(e,l,n),o=!0,e.mousePressed=a=>ze(e,n,t,s,a),u(),document.oncontextmenu=()=>!1},e.draw=()=>{o&&ye(e,n,t,s)},e.windowResized=()=>{c(),u()};function c(){let a=e.windowWidth,r=a*9/16;r>e.windowHeight&&(r=e.windowHeight,a=r*16/9),i&&i.remove(),i=e.createCanvas(a,r),i.position((e.windowWidth-a)/2,(e.windowHeight-r)/2),i.style("z-index","0")}function u(){const a=e.select("#configDiv");!i||!a||a.position(20,20)}});
